return function()
  local mock = require("deftest.mock.mock")
  local i18n = require("modules.i18n")
  local log = require("modules.log")
  local settings = require("modules.settings")

  describe("i18n", function()
    before(function()
      log.set_level(log.FATAL)
      log.set_print(false)

      mock.mock(settings)
      mock.mock(sys)
    end)

    after(function()
      mock.unmock(settings)
      mock.unmock(sys)
    end)

    describe("init", function()
      it("loads the list of languages", function()
        i18n.init()
        assert_same({ "en", "es", "fr" }, i18n.get_language_list())
      end)

      it("uses language in settings when language in settings is supported", function()
        settings.get_language.always_returns("fr")
        i18n.init()
        assert_equal("fr", i18n.get_language())
      end)

      it("uses default when language in settings isn't supported", function()
        settings.get_language.always_returns("zu")
        i18n.init()
        assert_equal("en", i18n.get_language())
      end)

      it("uses system language when settings is empty, and system language is supported", function()
        settings.get_language.always_returns(nil)
        sys.get_sys_info.always_returns({ language = "fr" })
        i18n.init()
        assert_equal("fr", i18n.get_language())
      end)

      it("uses default when settings is empty, and system language isn't supported", function()
        settings.get_language.always_returns(nil)
        sys.get_sys_info.always_returns({ language = "zu" })
        i18n.init()
        assert_equal("en", i18n.get_language())
      end)
    end)

    describe("get_language_list", function()
      it("returns the list of supported languages", function()
        i18n.init()
        assert_same({ "en", "es", "fr" }, i18n.get_language_list())
      end)
    end)

    describe("get_language", function()
      it("returns the current language", function()
        i18n.init()
        i18n.set_language("fr")
        assert_equal("fr", i18n.get_language())
      end)
    end)

    describe("get_text", function()
      it("returns the translated text for the current language", function()
        i18n.init()
        i18n.set_language("fr")
        assert_equal("Jouer", i18n.get_text("button_play"))
      end)
    end)
  end)
end
