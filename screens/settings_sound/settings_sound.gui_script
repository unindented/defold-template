local actions = require("modules.actions")
local navigation = require("modules.navigation")
local ui = require("ui.ui")

function init(self)
  ui.acquire_input()
  ui.set_render_order_popup_content()

  local master_volume = sound.get_group_gain(hash("master"))
  local music_volume = sound.get_group_gain(hash("music"))
  local effects_volume = sound.get_group_gain(hash("effects"))

  ui.heading("heading")
  ui.slider("master_volume").scroll_to(1 - master_volume, 0)
  ui.slider("music_volume").scroll_to(1 - music_volume, 0)
  ui.slider("effects_volume").scroll_to(1 - effects_volume, 0)
  ui.button("back")

  self.root = gui.get_node("root")
  self.transition = navigation.transition_popup(self.root)
end

function on_input(self, action_id, action)
  if action_id == actions.ESCAPE and action.released then
    navigation.popup_pop()
    return true
  end

  local group = ui.group("group", function()
    ui.slider("master_volume", nil, action_id, action, function(slider)
      sound.set_group_gain(hash("master"), 1 - slider.scroll.x)
    end)
    ui.slider("music_volume", nil, action_id, action, function(slider)
      sound.set_group_gain(hash("music"), 1 - slider.scroll.x)
    end)
    ui.slider("effects_volume", nil, action_id, action, function(slider)
      sound.set_group_gain(hash("effects"), 1 - slider.scroll.x)
    end)
    ui.button("back", nil, action_id, action, function()
      navigation.popup_pop()
    end)
  end)
  return group.consumed
end

function on_message(self, message_id, message, sender)
  self.transition.handle(message_id, message, sender)
end
